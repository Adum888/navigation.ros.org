

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing a New Planner Plugin &mdash; Navigation 2 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon-48x48.png"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'1.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Configuration Guidelines" href="../../configuration/index.html" />
    <link rel="prev" title="Writing a New Costmap2D Plugin" href="writing_new_costmap2d_plugin.html" />

<link rel="stylesheet" href="../../_static/tcs_theme.css" type="text/css" />


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Navigation 2
          

          
            
            <img src="../../_static/logo_white_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#running-the-example">Running the Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#navigating">Navigating</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../build_instructions/index.html">Build and Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../build_instructions/index.html#install">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build_instructions/index.html#build">Build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../build_instructions/index.html#build-navigation2-for-released-distribution">Build Navigation2 For Released Distribution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#install-ros">Install ROS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#build-navigation2">Build Navigation2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../build_instructions/index.html#quickstart-build-master">Quickstart Build Master</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#steps">Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#options">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../build_instructions/index.html#manually-build-master">Manually Build Master</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#build-ros-2-master">Build ROS 2 Master</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#build-navigation2-dependencies">Build Navigation2 Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/index.html#build-navigation2-master">Build Navigation2 Master</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../build_instructions/index.html#docker">Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../build_instructions/index.html#building-docker-container">Building Docker Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../build_instructions/index.html#using-dockerhub-container">Using DockerHub Container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../build_instructions/index.html#generate-doxygen">Generate Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build_instructions/index.html#help">Help</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../build_instructions/build_docs/build_troubleshooting_guide.html">Build Troubleshooting Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/build_docs/build_troubleshooting_guide.html#common-navigation2-dependencies-build-failures">Common Navigation2 Dependencies Build Failures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../build_instructions/build_docs/build_troubleshooting_guide.html#reporting-issue">Reporting Issue</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/index.html">Navigation Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/index.html#ros2">ROS2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#action-server">Action Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#lifecycle-nodes">Lifecycle Nodes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/index.html#behavior-trees">Behavior Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/index.html#navigation-servers">Navigation Servers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#planner-controller-and-recovery-servers">Planner, Controller, and Recovery Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#planners">Planners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#controllers">Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#recoveries">Recoveries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/index.html#state-estimation">State Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#standards">Standards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#global-positioning-localization-and-slam">Global Positioning: Localization and SLAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#odometry">Odometry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/index.html#environmental-representation">Environmental Representation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#costmaps-and-layers">Costmaps and Layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts/index.html#other-forms">Other Forms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="navigation2_on_real_turtlebot3.html">Navigating with a Physical Turtlebot 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#setup-your-enviroment-variables">0- Setup Your Enviroment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#launch-turtlebot-3">1- Launch Turtlebot 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#launch-navigation2">2- Launch Navigation2</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#launch-rviz">3-  Launch RVIZ</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#initialize-the-location-of-turtlebot-3">4- Initialize the Location of Turtlebot 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_on_real_turtlebot3.html#send-a-goal-pose">5-  Send a Goal Pose</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="navigation2_with_slam.html">(SLAM) Navigating While Mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="navigation2_with_slam.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation2_with_slam.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation2_with_slam.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_slam.html#launch-robot-interfaces">0- Launch Robot Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_slam.html#launch-navigation2">1- Launch Navigation2</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_slam.html#launch-slam">2- Launch SLAM</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_slam.html#working-with-slam">3- Working with SLAM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="navigation2_with_stvl.html">(STVL) Using an External Costmap Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="navigation2_with_stvl.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation2_with_stvl.html#costmap2d-and-stvl">Costmap2D and STVL</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation2_with_stvl.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_stvl.html#setup">0- Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_stvl.html#install-stvl">1- Install STVL</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_stvl.html#modify-navigation2-parameter">1- Modify Navigation2 Parameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_stvl.html#launch-navigation2">2- Launch Navigation2</a></li>
<li class="toctree-l4"><a class="reference internal" href="navigation2_with_stvl.html#rviz">3-  RVIZ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="writing_new_costmap2d_plugin.html">Writing a New Costmap2D Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="writing_new_costmap2d_plugin.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="writing_new_costmap2d_plugin.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="writing_new_costmap2d_plugin.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writing_new_costmap2d_plugin.html#write-a-new-costmap2d-plugin">1- Write a new Costmap2D plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="writing_new_costmap2d_plugin.html#export-and-make-gradientlayer-plugin">2- Export and make GradientLayer plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="writing_new_costmap2d_plugin.html#enable-the-plugin-in-costmap2d">3- Enable the plugin in Costmap2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="writing_new_costmap2d_plugin.html#run-gradientlayer-plugin">4- Run GradientLayer plugin</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing a New Planner Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-new-planner-plugin">1- Creating a new Planner Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exporting-the-planner-plugin">2- Exporting the planner plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pass-the-plugin-name-through-params-file">3- Pass the plugin name through params file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-straightline-plugin">4- Run StraightLine plugin</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/configuring-the-controller.html">Configuring The Controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/configuring-the-controller.html#controller-server">Controller Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/configuring-the-controller.html#parameters">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/configuring-the-controller.html#progress-checker">Progress Checker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/configuring-the-controller.html#id2">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/configuring-the-controller.html#dwb-controller">DWB Controller</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/configuring-the-controller.html#id3">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/configuring-the-controller.html#additional-parameters">Additional Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/configuring-the-controller.html#debug-parameters">Debug Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/configuring-the-controller.html#dwb-plugins">DWB Plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/dwb-plugins/trajectory-generators.html">Trajectory Generators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/dwb-plugins/trajectory-critics.html">Trajectory Critics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../configuration/dwb-plugins/goal-checkers.html">Goal Checkers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/params/tunable-params.html">Tunable Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#amcl">AMCL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#controller-server">Controller Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#local-costmap">Local Costmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#planner-server">Planner Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#global-costmap">Global Costmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#map-server">Map Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#recovery-server">Recovery Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/params/tunable-params.html#bt-navigator">BT Navigator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Navigation Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.html#costmap-layers">Costmap Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.html#controllers">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.html#planners">Planners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.html#recoveries">Recoveries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.html#behavior-tree-nodes">Behavior Tree Nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../migration/Dashing.html">Dashing to Eloquent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/Dashing.html#new-packages">New Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/Dashing.html#new-plugins">New Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/Dashing.html#navigation2-architectural-changes">Navigation2 Architectural Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../migration/Eloquent.html">Eloquent to Foxy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../migration/Eloquent.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/Eloquent.html#server-updates">Server Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../migration/Eloquent.html#new-plugins">New Plugins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Getting Involved</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/index.html#id1">Getting Involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/index.html#process">Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/index.html#licensing">Licensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/index.html#developer-certification-of-origin-dco">Developer Certification of Origin (DCO)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About and Contact</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/robots.html">Robots Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/ros1_comparison.html">ROS to ROS2 Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#id1">About</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/index.html#contact">Contact</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Navigation 2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials</a> &raquo;</li>
        
      <li>Writing a New Planner Plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-a-new-planner-plugin">
<span id="writing-new-nav2planner-plugin"></span><h1>Writing a New Planner Plugin<a class="headerlink" href="#writing-a-new-planner-plugin" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#tutorial-steps">Tutorial Steps</a></li>
</ul>
<a class="reference internal image-reference" href="../../_images/nav2_straightline_gif.gif"><img alt="Animated gif with gradient demo" class="align-center" src="../../_images/nav2_straightline_gif.gif" style="width: 700px;" /></a>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This tutorial shows how to create you own planner plugin.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>ROS2 (binary or build-from-source)</li>
<li>Navigation2 (Including dependencies)</li>
<li>Gazebo</li>
<li>Turtlebot3</li>
</ul>
</div>
<div class="section" id="tutorial-steps">
<h2>Tutorial Steps<a class="headerlink" href="#tutorial-steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-new-planner-plugin">
<h3>1- Creating a new Planner Plugin<a class="headerlink" href="#creating-a-new-planner-plugin" title="Permalink to this headline">¶</a></h3>
<p>We will create a simple straight line planner.
The annotated code in this tutorial can be found in <a class="reference external" href="https://github.com/ros-planning/navigation2_tutorials">navigation_tutorials</a> repository as the <code class="docutils literal notranslate"><span class="pre">nav2_straightline_planner</span></code>
This package can be a considered as a reference for writing planner plugin.</p>
<p>Our example plugin inherits from the base class <code class="docutils literal notranslate"><span class="pre">nav2_core::GlobalPlanner</span></code>. The base class provides 5 pure virtual methods to implement a planner plugin. The plugin will be used by the planner server to compute trajectories.
Lets learn more about the methods needed to write a planner plugin.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="62%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Virtual method</strong></td>
<td><strong>Method description</strong></td>
<td><strong>Requires override?</strong></td>
</tr>
<tr class="row-even"><td>configure()</td>
<td>Method is called at when planner server enters on_configure state. Ideally
this methods should perform declarations of ROS parameters and
initialization of planner’s member variables. This method takes 4 input
params: shared pointer to parent node, planner name, tf buffer pointer and
shared pointer to costmap.</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>activate()</td>
<td>Method is called when planner server enters on_activate state. Ideally this
method should implement operations which are neccessary before planner goes
to an active state.</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>deactivate()</td>
<td>Method is called when planner server enters on_deactivate state. Ideally
this method should implement operations which are neccessary before planner
goes to an inactive state.</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>cleanup()</td>
<td>Method is called when planner server goes to on_cleanup state. Ideally this
method should clean up resoures which are created for the planner.</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>createPlan()</td>
<td>Method is called when planner server demands a global plan for specified
start and goal pose. This method returns <cite>nav_msgs::msg::Path</cite> carrying
global plan. This method takes 2 input parmas: start pose and goal pose.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>For this tutorial, we will be using methods <code class="docutils literal notranslate"><span class="pre">StraightLine::configure()</span></code> and <code class="docutils literal notranslate"><span class="pre">StraightLine::createPlan()</span></code> to create straight line planner.</p>
<p>In planners, <code class="docutils literal notranslate"><span class="pre">configure()</span></code> method must set member variables from ROS parameters and any initialization required,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">node_</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
<span class="n">tf_</span> <span class="o">=</span> <span class="n">tf</span><span class="p">;</span>
<span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
<span class="n">costmap_</span> <span class="o">=</span> <span class="n">costmap_ros</span><span class="o">-&gt;</span><span class="n">getCostmap</span><span class="p">();</span>
<span class="n">global_frame_</span> <span class="o">=</span> <span class="n">costmap_ros</span><span class="o">-&gt;</span><span class="n">getGlobalFrameID</span><span class="p">();</span>

<span class="c1">// Parameter initialization</span>
<span class="n">nav2_util</span><span class="o">::</span><span class="n">declare_parameter_if_not_declared</span><span class="p">(</span><span class="n">node_</span><span class="p">,</span> <span class="n">name_</span> <span class="o">+</span> <span class="s">&quot;.interpolation_resolution&quot;</span><span class="p">,</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">ParameterValue</span><span class="p">(</span><span class="mf">0.1</span><span class="p">));</span>
<span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">name_</span> <span class="o">+</span> <span class="s">&quot;.interpolation_resolution&quot;</span><span class="p">,</span> <span class="n">interpolation_resolution_</span><span class="p">);</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">name_</span> <span class="pre">+</span> <span class="pre">&quot;.interpolation_resolution&quot;</span></code> is fetching the ROS parameters <code class="docutils literal notranslate"><span class="pre">interpolation_resolution</span></code> which is specific to our planner. Navigation2 allows loading of multiple plugins and to keep things organized each plugin is mapped to some ID/name. Now if we want to retrieve the parameters for that specific plugin, we use <code class="docutils literal notranslate"><span class="pre">&lt;mapped_name_of_plugin&gt;.&lt;name_of_parameter&gt;</span></code> as done in the above snippet. For example, our example planner is mapped to the name “GridBased” and to retrieve the <code class="docutils literal notranslate"><span class="pre">interpolation_resolution</span></code> parameter which is specific to “GridBased”, we used <code class="docutils literal notranslate"><span class="pre">Gridbased.interpolation_resolution</span></code>. In other words, <code class="docutils literal notranslate"><span class="pre">GridBased</span></code> is used as a namespace for plugin-specific parameters. We will see more on this when we discuss the parameters file (or params file).</p>
<p>In <code class="docutils literal notranslate"><span class="pre">createPlan()</span></code> method, we need to create a path from the given start to goal poses. The <code class="docutils literal notranslate"><span class="pre">StraightLine::createPlan()</span></code> is called using start pose and goal pose to solve the global path planning problem. Upon succeeding, it converts the path to the <code class="docutils literal notranslate"><span class="pre">nav_msgs::msg::Path</span></code> and returns to the planner server. Below annotation shows the implementation of this method.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Path</span> <span class="n">global_path</span><span class="p">;</span>

<span class="c1">// Checking if the goal and start state is in the global frame</span>
<span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">!=</span> <span class="n">global_frame_</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">RCLCPP_ERROR</span><span class="p">(</span>
    <span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">&quot;Planner will only except start position from %s frame&quot;</span><span class="p">,</span>
    <span class="n">global_frame_</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">global_path</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">goal</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">!=</span> <span class="n">global_frame_</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">RCLCPP_INFO</span><span class="p">(</span>
    <span class="n">node_</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">&quot;Planner will only except goal position from %s frame&quot;</span><span class="p">,</span>
    <span class="n">global_frame_</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">global_path</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">global_path</span><span class="p">.</span><span class="n">poses</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="n">global_path</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">node_</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">();</span>
<span class="n">global_path</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="n">global_frame_</span><span class="p">;</span>
<span class="c1">// calculating the number of loops for current value of interpolation_resolution_</span>
<span class="kt">int</span> <span class="n">total_number_of_loop</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">hypot</span><span class="p">(</span>
  <span class="n">goal</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">start</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
  <span class="n">goal</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">start</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span>
  <span class="n">interpolation_resolution_</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">x_increment</span> <span class="o">=</span> <span class="p">(</span><span class="n">goal</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">start</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_number_of_loop</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">y_increment</span> <span class="o">=</span> <span class="p">(</span><span class="n">goal</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">start</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_number_of_loop</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">total_number_of_loop</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PoseStamped</span> <span class="n">pose</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x_increment</span> <span class="o">*</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">y_increment</span> <span class="o">*</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">node_</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">();</span>
  <span class="n">pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="n">global_frame_</span><span class="p">;</span>
  <span class="n">global_path</span><span class="p">.</span><span class="n">poses</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pose</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">global_path</span><span class="p">.</span><span class="n">poses</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">goal</span><span class="p">);</span>

<span class="k">return</span> <span class="n">global_path</span><span class="p">;</span>
</pre></div>
</div>
<p>The remaining methods are not used but its mandatory to override them. As per the rules, we did override all but left them blank.</p>
</div>
<div class="section" id="exporting-the-planner-plugin">
<h3>2- Exporting the planner plugin<a class="headerlink" href="#exporting-the-planner-plugin" title="Permalink to this headline">¶</a></h3>
<p>Now that we have created our custom planner, we need to export our planner plugin so that it would be visible to the planner server. Plugins are loaded at runtime and if they are not visible, then our planner server won’t be able to load it. In ROS2, exporting and loading plugins is handled by <code class="docutils literal notranslate"><span class="pre">pluginlib</span></code>.</p>
<p>Coming to our tutorial, class <code class="docutils literal notranslate"><span class="pre">nav2_straightline_planner::StraightLine</span></code> is loaded dynamically as <code class="docutils literal notranslate"><span class="pre">nav2_core::GlobalPlanner</span></code> which is our base class.</p>
<ol class="arabic simple">
<li>To export the planner, we need to provide two lines</li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;pluginlib/class_list_macros.hpp&quot;</span><span class="cp"></span>
<span class="n">PLUGINLIB_EXPORT_CLASS</span><span class="p">(</span><span class="n">nav2_straightline_planner</span><span class="o">::</span><span class="n">StraightLine</span><span class="p">,</span> <span class="n">nav2_core</span><span class="o">::</span><span class="n">GlobalPlanner</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that it requires pluginlib to export out plugin’s class. Pluginlib would provide as macro <code class="docutils literal notranslate"><span class="pre">PLUGINLIB_EXPORT_CLASS</span></code> which does all the work of exporting.</p>
<p>It is good practice to place these lines at the end of the file but technically, you can also write at the top.</p>
<ol class="arabic simple" start="2">
<li>Next step would be to create plugin’s description file in the root directory of the package. For example, <code class="docutils literal notranslate"><span class="pre">global_planner_plugin.xml</span></code> file in our tutorial package. This file contains following information</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">library</span> <span class="pre">path</span></code>: Plugin’s library name and it’s location.</li>
<li><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">name</span></code>: Name of the class.</li>
<li><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">type</span></code>: Type of class.</li>
<li><code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">class</span></code>: Name of the base class.</li>
<li><code class="docutils literal notranslate"><span class="pre">description</span></code>: Description of the plugin.</li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;library</span> <span class="na">path=</span><span class="s">&quot;nav2_straightline_planner_plugin&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;nav2_straightline_planner/StraightLine&quot;</span> <span class="na">type=</span><span class="s">&quot;nav2_straightline_planner::StraightLine&quot;</span> <span class="na">base_class_type=</span><span class="s">&quot;nav2_core::GlobalPlanner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;description&gt;</span>This is an example plugin which produces straight path.<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/library&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Next step would be to export plugin using <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> by using cmake function <code class="docutils literal notranslate"><span class="pre">pluginlib_export_plugin_description_file()</span></code>. This function installs plugin description file to <code class="docutils literal notranslate"><span class="pre">share</span></code> directory and sets ament indexes to make it discoverable.</li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pluginlib_export_plugin_description_file(nav2_core global_planner_plugin.xml)
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Plugin description file should also be added to <code class="docutils literal notranslate"><span class="pre">package.xml</span></code></li>
</ol>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;export&gt;</span>
  <span class="nt">&lt;build_type&gt;</span>ament_cmake<span class="nt">&lt;/build_type&gt;</span>
  <span class="nt">&lt;nav2_core</span> <span class="na">plugin=</span><span class="s">&quot;${prefix}/global_planner_plugin.xml&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/export&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Compile and it should be registered. Next, we’ll use this plugin.</li>
</ol>
</div>
<div class="section" id="pass-the-plugin-name-through-params-file">
<h3>3- Pass the plugin name through params file<a class="headerlink" href="#pass-the-plugin-name-through-params-file" title="Permalink to this headline">¶</a></h3>
<p>To enable the plugin, we need to modify the <code class="docutils literal notranslate"><span class="pre">nav2_params.yaml</span></code> file as below</p>
<p>replace following params</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>planner_server:
ros__parameters:
  planner_plugin_types: [&quot;nav2_navfn_planner/NavfnPlanner&quot;]
  planner_plugin_ids: [&quot;GridBased&quot;]
  use_sim_time: True
  GridBased.tolerance: 2.0
  GridBased.use_astar: false
  GridBased.allow_unknown: true
</pre></div>
</div>
<p>with</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>planner_server:
ros__parameters:
  planner_plugin_types: [&quot;nav2_straightline_planner/StraightLine&quot;]
  planner_plugin_ids: [&quot;GridBased&quot;]
  use_sim_time: True
  GridBased.interpolation_resolution: 0.1
</pre></div>
</div>
<p>In the above snippet, you can observe the mapping of our <code class="docutils literal notranslate"><span class="pre">nav2_straightline_planner/StraightLine</span></code> planner to its id <code class="docutils literal notranslate"><span class="pre">GridBased</span></code>. To pass plugin-specific parameters we have used <code class="docutils literal notranslate"><span class="pre">&lt;plugin_id&gt;.&lt;plugin_specific_parameter&gt;</span></code>.</p>
</div>
<div class="section" id="run-straightline-plugin">
<h3>4- Run StraightLine plugin<a class="headerlink" href="#run-straightline-plugin" title="Permalink to this headline">¶</a></h3>
<p>Run Turtlebot3 simulation with enabled navigation2. Detailed instruction how to make it are written at <a class="reference internal" href="../../getting_started/index.html#getting-started"><span class="std std-ref">Getting Started</span></a>. Below is shortcut command for that:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ros2 launch nav2_bringup tb3_simulation_launch.py params_file:<span class="o">=</span>/path/to/your_params_file.yaml
</pre></div>
</div>
<p>Then goto RViz and click on the “2D Pose Estimate” button at the top and point the location on map as it was described in <a class="reference internal" href="../../getting_started/index.html#getting-started"><span class="std std-ref">Getting Started</span></a>. Robot will localize on the map and then click on “Navigation2 goal” and click on the pose where you want your planner to consider a goal pose. After that planner will plan the path and robot will start moving towards the goal.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  

<script type="text/javascript" src="../../_static/tcs_theme.js"></script>



</body>
</html>